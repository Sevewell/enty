{% extends "base.html" %}

{% block title %}è³‡ç”£ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">è³‡ç”£ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
    </div>
</div>

<div class="row">
    <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
    <div class="col-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="card-title">äººå“¡</h6>
                        <h3 class="mb-0" id="staff-count">-</h3>
                    </div>
                    <div class="fs-1">ğŸ‘¥</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="card-title">ãƒ‡ãƒã‚¤ã‚¹</h6>
                        <h3 class="mb-0" id="device-count">-</h3>
                    </div>
                    <div class="fs-1">ğŸ’»</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="card-title">ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢</h6>
                        <h3 class="mb-0" id="software-count">-</h3>
                    </div>
                    <div class="fs-1">ğŸ’¿</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-3">
        <div class="card bg-warning text-dark">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="card-title">ã‚ªãƒ•ã‚£ã‚¹æ©Ÿå™¨</h6>
                        <h3 class="mb-0" id="office-count">-</h3>
                    </div>
                    <div class="fs-1">ğŸ–¨ï¸</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="col-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('entity_list') }}" class="btn btn-outline-primary">
                        ğŸ“‹ å…¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è¡¨ç¤º
                    </a>
                    <a href="{{ url_for('entity_list', type=1) }}" class="btn btn-outline-primary">
                        ğŸ‘¥ äººå“¡ä¸€è¦§
                    </a>
                    <a href="{{ url_for('entity_list', type=2) }}" class="btn btn-outline-success">
                        ğŸ’» ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§
                    </a>
                    <a href="{{ url_for('entity_list', type=3) }}" class="btn btn-outline-info">
                        ğŸ’¿ ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ä¸€è¦§
                    </a>
                    <a href="{{ url_for('entity_list', type=4) }}" class="btn btn-outline-warning">
                        ğŸ–¨ï¸ ã‚ªãƒ•ã‚£ã‚¹æ©Ÿå™¨ä¸€è¦§
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æœ€è¿‘ã®æ´»å‹• -->
    <div class="col-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">æœ€è¿‘è¿½åŠ ã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£</h5>
            </div>
            <div class="card-body">
                <div id="recent-entities">
                    <div class="text-muted text-center py-3">
                        èª­ã¿è¾¼ã¿ä¸­...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardData();
});

function loadDashboardData() {
    // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—
    fetch('/api/dashboard-stats')
        .then(response => response.json())
        .then(data => {
            document.getElementById('staff-count').textContent = data.staff || 0;
            document.getElementById('device-count').textContent = data.devices || 0;
            document.getElementById('software-count').textContent = data.software || 0;
            document.getElementById('office-count').textContent = data.office || 0;
        })
        .catch(error => {
            console.error('çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—:', error);
            // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¡¨ç¤º
            document.getElementById('staff-count').textContent = '0';
            document.getElementById('device-count').textContent = '0';
            document.getElementById('software-count').textContent = '0';
            document.getElementById('office-count').textContent = '0';
        });
    
    // æœ€è¿‘ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
    fetch('/api/recent-entities')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('recent-entities');
            if (data.length === 0) {
                container.innerHTML = '<div class="text-muted text-center py-3">æœ€è¿‘è¿½åŠ ã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            const html = data.map(entity => `
                <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                    <div>
                        <strong>${entity.title}</strong>
                        <small class="text-muted d-block">${entity.type_name}</small>
                    </div>
                    <div class="text-end">
                        <small class="text-muted">${entity.date_in}</small>
                        <br>
                        <a href="/assets/entity/${entity.identifier}" class="btn btn-sm btn-outline-primary">è©³ç´°</a>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        })
        .catch(error => {
            console.error('æœ€è¿‘ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—:', error);
            document.getElementById('recent-entities').innerHTML = 
                '<div class="text-danger text-center py-3">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
        });
}
</script>
{% endblock %}
